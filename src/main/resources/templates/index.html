<!DOCTYPE html>
<html lang="nl" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Homepagina</title>
</head>
<body>

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mt-4">
  <h1>Welkom op de Homepagina!</h1>

  <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="cartDropdown" style="min-width: 300px;">
    <h6 class="dropdown-header">Winkelmandje</h6>

    <div th:if="${#lists.isEmpty(cartItems)}">
      <p class="text-muted">Winkelmandje is leeg.</p>
    </div>

    <table class="table table-sm" th:if="${!#lists.isEmpty(cartItems)}">
      <thead>
      <tr>
        <th>Productnaam</th>
        <th>Aantal</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="entry : ${cartItems}">
        <td th:text="${entry.key.name}">Productnaam</td>
        <td th:text="${entry.value}">Aantal</td>
        <td>
          <form th:action="@{/index/remove}" method="post">
            <input type="hidden" name="productId" th:value="${entry.key.id}" />
            <button type="submit" class="btn btn-sm btn-danger">Verwijder</button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>

    <div class="d-grid">
      <form th:action="@{/index/placeorder}" method="post">
        <button type="submit" class="btn btn-primary btn-sm">Bestellen</button>
      </form>
    </div>
  </div>

  <div class="row align-items-center mt-5 mb-3">
    <div class="col-md-6">
      <h2>Populaire producten</h2>
    </div>
    <div class="col-md-6 text-end">
      <form class="d-flex" method="get" action="/index">
        <input class="form-control me-2" type="search" name="search"
               placeholder="Zoek product..." th:value="${searchTerm}" />

        <select class="form-select me-2" name="category">
          <option th:value="0" th:selected="${selectedCategory == null}">Alle categorieÃ«n</option>
          <option th:each="cat : ${categories}"
                  th:value="${cat.id}"
                  th:text="${cat.name}"
                  th:selected="${selectedCategory == cat.id}">
          </option>
        </select>

        <button class="btn btn-outline-primary" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>
    </div>
  </div>
  <hr/>

  <div class="row">
    <div class="col-md-4 mb-4" th:each="product : ${popularProducts}">
      <div class="card h-100">
        <img th:src="${product.image != null ? product.image : '/images/default.png'}" class="card-img-top" th:alt="${product.name}" />
        <div class="card-body">
          <h5 class="card-title" th:text="${product.name}">Productnaam</h5>
          <p class="card-text"><strong>In stock:</strong> <span th:text="${product.stock}">0</span></p>
          <form method="post" th:action="@{/index/add}">
            <input type="hidden" name="productId" th:value="${product.id}" />
            <input type="number" name="aantal" class="form-control mb-2" min="1" value="1" />
            <button class="btn btn-primary" type="submit">Toevoegen</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Producten per categorie -->
  <div class="row align-items-center mt-5 mb-3">
    <div class="col-md-6">
      <h2>Producten per categorie</h2>
    </div>
  </div>
  <hr/>

  <div th:each="entry : ${productsByCategory}">
    <h3 th:text="${entry.key}">Categorie</h3>
    <div class="row mb-4">
      <div class="col-md-4" th:each="product : ${entry.value}">
        <div class="card h-100">
          <img th:src="${product.image != null ? product.image : '/images/default.png'}" class="card-img-top" th:alt="${product.name}" />
          <div class="card-body">
            <h5 class="card-title" th:text="${product.name}">Productnaam</h5>
            <p class="card-text"><strong>In stock:</strong> <span th:text="${product.stock}">0</span></p>
            <form method="post" th:action="@{/index/add}">
              <input type="hidden" name="productId" th:value="${product.id}" />
              <input type="number" name="aantal" class="form-control mb-2" min="1" value="1" />
              <button class="btn btn-primary" type="submit">Toevoegen</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>


</body>
</html>